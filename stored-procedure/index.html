<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Stored Procedure &middot; Nurul Uhkrowi</title>
        <meta name="description" content="Recently I have to work with stored procedures for a pretty huge monolith project, it’s not something new for me but I’ve been leaving it for a quite long time so I need to refresh my knowledge.
To get it simplified, stored procedure is just a bunch of SQL queries that wrapped and can be executed with a single command (you can also call functions in it when you have several common tasks to run).">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="generator" content="Hugo 0.100.1" />
        <meta name="robots" content="index,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta property="og:title" content="Stored Procedure">
<meta property="og:description" content="Recently I have to work with stored procedures for a pretty huge monolith project, it’s not something new for me but I’ve been leaving it for a quite long time so I need to refresh my knowledge.
To get it simplified, stored procedure is just a bunch of SQL queries that wrapped and can be executed with a single command (you can also call functions in it when you have several common tasks to run).">
<meta property="og:type" content="article">
<meta property="og:url" content="/stored-procedure/">
        <link rel="stylesheet" href="/dist/site.css">
        <link rel="stylesheet" href="/dist/syntax.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
        
        
        
        
        

    </head>
    <body>
        

        <div id="wrapper">
            <header class="site-header">
                <div class="container">
                    <div class="site-title-wrapper">
                        
                            <a class="button-square button-social hint--top" data-hint="Home" aria-label="Home" href="/" rel="me" >
                                <i class="fa fa-home" aria-hidden="true"></i>
                            </a>
                            
                        
                        
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Facebook" aria-label="Facebook" href="https://facebook.com/uhkrowi" rel="me">
                                <i class="fa fa-facebook" aria-hidden="true"></i>
                            </a>
                        
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Github" aria-label="Github" href="https://github.com/uhkrowi" rel="me">
                                <i class="fa fa-github-alt" aria-hidden="true"></i>
                            </a>
                        
                        
                        
                            <a class="button-square button-social hint--top" data-hint="LinkedIn" aria-label="LinkedIn" href="https://www.linkedin.com/in/uhkrowi" rel="me">
                                <i class="fa fa-linkedin" aria-hidden="true"></i>
                            </a>
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Email" aria-label="Send an Email" href="mailto:uhkrowi@gmail.com">
                                <i class="fa fa-envelope" aria-hidden="true"></i>
                            </a>
                        
                    </div>

                    <ul class="site-nav">
                        
    <li class="site-nav-item">
        <a href="/page/about/">About</a>
    </li>

    <li class="site-nav-item">
        <a href="/">Blog</a>
    </li>

    <li class="site-nav-item">
        <a href="/page/project/">Project</a>
    </li>


                    </ul>
                </div>
            </header>

            <div id="container">


<div class="container">
    <article class="post-container" itemscope="" itemtype="http://schema.org/BlogPosting">
        <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Stored Procedure</h1>
    
    <p class="post-date">
        <span>Published <time datetime="2022-02-27" itemprop="datePublished">Feb 27, 2022</time></span>
    </p>
</header>

        <div class="post-content clearfix" itemprop="articleBody">
    

    <p>Recently I have to work with stored procedures for a pretty huge monolith project, it’s not something new for me but I’ve been leaving it for a quite long time so I need to refresh my knowledge.</p>
<p>To get it simplified, stored procedure is just a bunch of SQL queries that wrapped and can be executed with a single command (you can also call functions in it when you have several common tasks to run).</p>
<p>Anyway I don’t really like to manipulate data through neither SQL stored procedures, functions nor views, because I don’t want to separate my app logics, so I do every manipulating processes on the backend code with ORM’s query builder or a plain query if possible.</p>
<p>That’s not a big deal tho, if you prefer to do so, you could group the queries into a single stored procedure then execute it when needed.</p>
<p>Okay, now we know what do stored procedures used for, let’s get some practices.</p>
<p>&hellip;</p>
<h3 id="creating-tables-and-put-some-values">Creating tables and put some values</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> Employee
</span></span><span style="display:flex;"><span>(ID INT <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">IDENTITY</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>, FullName VARCHAR(<span style="color:#ae81ff">100</span>), Salary DECIMAL)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GO</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> EmployeeAttendance
</span></span><span style="display:flex;"><span>(ID INT <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">IDENTITY</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>, EmployeeID INT, TimeIn DATETIME, TimeOut DATETIME)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GO</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> Employee (FullName, Salary) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;Leo Wick&#39;</span>, <span style="color:#ae81ff">5000</span>)
</span></span><span style="display:flex;"><span>,(<span style="color:#e6db74">&#39;Peter Potter&#39;</span>, <span style="color:#ae81ff">4500</span>)
</span></span><span style="display:flex;"><span>,(<span style="color:#e6db74">&#39;Harry Parker&#39;</span>, <span style="color:#ae81ff">6000</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GO</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> EmployeeAttendance (EmployeeID, TimeIn, TimeOut) <span style="color:#66d9ef">VALUES</span> (<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;2021-02-04 09:00:00&#39;</span>, <span style="color:#e6db74">&#39;2021-02-04 18:00:00&#39;</span>)
</span></span><span style="display:flex;"><span>,(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;2021-02-05 09:00:00&#39;</span>, <span style="color:#e6db74">&#39;2021-02-05 18:00:00&#39;</span>)
</span></span><span style="display:flex;"><span>,(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;2021-02-06 09:00:00&#39;</span>, <span style="color:#e6db74">&#39;2021-02-06 18:00:00&#39;</span>)
</span></span><span style="display:flex;"><span>,(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;2021-02-07 09:00:00&#39;</span>, <span style="color:#e6db74">&#39;2021-02-07 18:00:00&#39;</span>)
</span></span><span style="display:flex;"><span>,(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;2021-02-08 09:00:00&#39;</span>, <span style="color:#e6db74">&#39;2021-02-08 18:00:00&#39;</span>)
</span></span><span style="display:flex;"><span>,(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;2021-02-04 09:00:00&#39;</span>, <span style="color:#e6db74">&#39;2021-02-04 18:00:00&#39;</span>)
</span></span><span style="display:flex;"><span>,(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;2021-02-05 09:00:00&#39;</span>, <span style="color:#e6db74">&#39;2021-02-05 18:00:00&#39;</span>)
</span></span><span style="display:flex;"><span>,(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;2021-02-06 09:00:00&#39;</span>, <span style="color:#e6db74">&#39;2021-02-06 18:00:00&#39;</span>)
</span></span><span style="display:flex;"><span>,(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;2021-02-07 09:00:00&#39;</span>, <span style="color:#e6db74">&#39;2021-02-07 18:00:00&#39;</span>)
</span></span><span style="display:flex;"><span>,(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;2021-02-08 09:00:00&#39;</span>, <span style="color:#e6db74">&#39;2021-02-08 18:00:00&#39;</span>)
</span></span><span style="display:flex;"><span>,(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;2021-02-04 09:00:00&#39;</span>, <span style="color:#e6db74">&#39;2021-02-04 18:00:00&#39;</span>)
</span></span><span style="display:flex;"><span>,(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;2021-02-05 09:00:00&#39;</span>, <span style="color:#e6db74">&#39;2021-02-05 18:00:00&#39;</span>)
</span></span><span style="display:flex;"><span>,(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;2021-02-06 09:00:00&#39;</span>, <span style="color:#e6db74">&#39;2021-02-06 18:00:00&#39;</span>)
</span></span><span style="display:flex;"><span>,(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;2021-02-07 09:00:00&#39;</span>, <span style="color:#e6db74">&#39;2021-02-07 18:00:00&#39;</span>)
</span></span><span style="display:flex;"><span>,(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;2021-02-08 09:00:00&#39;</span>, <span style="color:#e6db74">&#39;2021-02-08 18:00:00&#39;</span>)
</span></span></code></pre></div><p><img src="/image-a1.png" alt="" title="Rows of employee"></p>
<p><img src="/image-1-1.png" alt="" title="Rows of employee attendance"></p>
<p>So, we have two tables now,</p>
<ol>
<li>Employee, contains employee’s basic data and;</li>
<li>EmployeeAttendance, contains time in and out of attendance of employees.</li>
</ol>
<p>What if you want to get data from the two tables joined? Yes, you can execute a plain query that combines/joins both of the tables. But what if you have any other complex operation for getting the data, such as you must calculate something, getting some values from another tables first, then insert data to the related tables right away, but you want to do so with ease and with only one single query of execution.</p>
<p>Yep, you’re right, wrap ’em into a <strong>stored procedure</strong>!</p>
<p>&hellip;</p>
<h3 id="creating-a-brand-new-stored-procedure">Creating a brand new stored procedure</h3>
<p>This query will get EmployeeID, FullName, TimeIn and TimeOut from joined tables of Employee and EmployeeAttendance.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> ea.EmployeeID, e.FullName, ea.TimeIn, ea.TimeOut <span style="color:#66d9ef">FROM</span> Employee e
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">JOIN</span> EmployeeAttendance ea <span style="color:#66d9ef">ON</span> e.ID <span style="color:#f92672">=</span> ea.EmployeeID 
</span></span></code></pre></div><p>Now, let’s wrap the query that getting data of joined the tables to a stored procedure. This store procedure will not contain complex action as I explain before, but you got the idea.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">PROCEDURE</span> GetEmployeeWithAttendance
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">AS</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">BEGIN</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SET</span> NOCOUNT <span style="color:#66d9ef">ON</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> ea.EmployeeID, e.FullName, ea.TimeIn, ea.TimeOut <span style="color:#66d9ef">FROM</span> Employee e
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">JOIN</span> EmployeeAttendance ea <span style="color:#66d9ef">ON</span> e.ID <span style="color:#f92672">=</span> ea.EmployeeID 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">END</span>
</span></span></code></pre></div><p>Then you can execute the stored procedure with exec command</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">exec</span> GetEmployeeWithAttendance
</span></span></code></pre></div><p><img src="/exec%20stored%20procedure.png" alt="" title="Exec stored procedure"></p>
<p>&hellip;</p>
<h3 id="passing-arguments">Passing arguments</h3>
<p>If you need to pass arguments to your stored procedure you can simply add parameter to it on creating stored procedure process, like so</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">PROCEDURE</span> GetEmployeeWithAttendanceByEmployeeID
</span></span><span style="display:flex;"><span>(<span style="color:#f92672">@</span>EmployeeID int)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">AS</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">BEGIN</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SET</span> NOCOUNT <span style="color:#66d9ef">ON</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> ea.EmployeeID, e.FullName, ea.TimeIn, ea.TimeOut <span style="color:#66d9ef">FROM</span> Employee e
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">JOIN</span> EmployeeAttendance ea <span style="color:#66d9ef">ON</span> e.ID <span style="color:#f92672">=</span> ea.EmployeeID 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> e.ID <span style="color:#f92672">=</span> <span style="color:#f92672">@</span>EmployeeID
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">END</span>
</span></span></code></pre></div><p>Then pass the arguments when execute it</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">exec</span> GetEmployeeWithAttendanceByEmployeeID <span style="color:#ae81ff">3</span>
</span></span></code></pre></div><p><img src="/image-3%20(1).png" alt="" title="Exec stored procedure with an argument"></p>

</div>

        <footer class="post-footer clearfix">
        <p class="post-tags">
            <span>Tagged:</span>
                <a href="/tags/sql/">SQL</a>
        </p>
    <div class="share">
            <a class="icon-twitter" href="https://twitter.com/share?text=Stored%20Procedure&url=%2fstored-procedure%2f"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" aria-label="Share on Twitter">
                <i class="fa fa-twitter" aria-hidden="true"></i>
            </a>
            <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=%2fstored-procedure%2f"
                onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" aria-label="Share on Facebook">
                <i class="fa fa-facebook" aria-hidden="true"></i>
            </a>
    </div>
</footer>

        
    </article>
</div>

            </div>
        </div>

        <footer class="footer">
            <div class="container">
                <div class="site-title-wrapper">
                    <h1 class="site-title">
                        <a href="/">Uhkrowi</a>
                    </h1>
                    <a class="button-square button-jump-top js-jump-top" href="#" aria-label="Back to Top">
                        <i class="fa fa-angle-up" aria-hidden="true"></i>
                    </a>
                </div>

                
            </div>
        </footer>

        <script src="/js/jquery-1.11.3.min.js"></script>
        <script src="/js/jquery.fitvids.js"></script>
        <script src="/js/scripts.js"></script>
        
    </body>
</html>

